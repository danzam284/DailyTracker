<html>
    <head>
        <link rel="stylesheet" href="/style/homepage.css">
    </head>
    <body>
        <form id="form" action="/water" method="POST" onsubmit="return false;"></form>
        <form id="form2" action="/frog" method="POST" onsubmit="return false;"></form>
        <form id="form3" action="/nutrition" method="POST" onsubmit="return false;"></form>
        <form id="form4" action="/sleep" method="POST" onsubmit="return false;"></form>
        <form id="form5" action="/worry" method="POST" onsubmit="return false;"></form>
        <form id="form6" action="/movement" method="POST" onsubmit="return false"></form>
        <form id="results" action="/team" method="POST" onsubmit="return false;"></form>
        <form id="lol" action="/home" method="POST" onsubmit="return false;"></form>
        <form id="icon" action="/changeIcon" method="POST" onsubmit="return false"></form>
        <div class="mute">
            <img id="mute__toggle" src="/images/speaker.png" onclick="changeIcon()">
        </div>
        <div class="hamburger-menu">
            <input id="menu__toggle" type="checkbox" />
            <label class="menu__btn" for="menu__toggle">
              <span></span>
            </label>
        
            <ul class="menu__box">
              <li><a class="menu__item" href="#" onclick="document.getElementById('lol').submit();">Home</a></li>
              <li><a class="menu__item" href="#" onclick="exit3();">Data</a></li>
              <li><a class="menu__item" href="#">Streaks</a></li>
            </ul>
        </div><br><br>

        <div id="box">
            <div id="welcome">
                <div id="w">
                    <div id="welc">Welcome Back!</div>
                </div>
                <div id="streak-container">
                    <div id="cur" name="cur"><div id="currentstreak">Current Streak</div>
                        <label id="lcur"></label>
                    </div>
                    <img id="imgh" src="/images/hiker.svg">
                    <div id="max" name="max"><div id="maxstreak">Max Streak</div>
                        <label id="lmax"></label>
                    </div>
                </div>
            </div>

            <div id="apps">
                <div class='row'>
                    <figure onclick='exit();'>
                        <img class="img" src='/images/water.png'>
                    </figure>
                    <figure onclick='exit2();'>
                        <img class="img" src='/images/frog.png'>
                    </figure>
                    <figure onclick='exit5();'>
                        <img class="img" src='/images/sleep icon.svg'>
                    </figure>
                </div>
                <div class='row'>
                    <figure onclick='exit6();'>
                        <img class="img" src='/images/worry icon-red.svg'>
                    </figure>
                    <figure onclick='exit4();'>
                        <img class="img" src='/images/nutrition icon2.svg'>
                    </figure>
                    <figure onclick='exit7();'>
                        <img class="img" src='/images/movement Icon.svg'>
                    </figure>
                </div>
            </div>
            <div id="mid">Day 1</div>
            <div id="map">
                <img class="hike" src="/trails/Trail 2.svg">
                <img class="hike" src="/trails/Trail 3.svg">
                <img class="hike" src="/trails/Trail 4.svg">
                <img class="hike" src="/trails/Trail 5.svg">
                <img class="hike" src="/trails/Trail 6.svg">
                <img class="hike" src="/trails/Trail 7.svg">
                <img class="hike" src="/trails/Trail 8.svg">
                <img class="hike" src="/trails/Trail 9.svg">
                <img class="hike" src="/trails/Trail 10.svg">
                <img class="hike" src="/trails/Trail 11.svg">
                <img class="hike" src="/trails/Trail 1.svg">
            </div>

            <div id="month">
                <header id="m" style="font-size:25px;text-align: center"></header>
                <div class="combo">
                    <span style="margin-left:10px;">Water</span>
                    <div class="inner">
                    </div>
                </div>
                <div class="combo">
                    <span style="margin-left:10px;">Frog</span>
                    <div class="inner">
                    </div>
                </div>
                <div class="combo">
                    <span style="margin-left:10px;">Sleep</span>
                    <div class="inner">
                    </div>
                </div>
                <div class="combo">
                    <span style="margin-left:10px;">Worry</span>
                    <div class="inner">
                    </div>
                </div>
                <div class="combo">
                    <span style="margin-left:10px;">Nutrition</span>
                    <div class="inner">
                    </div>
                </div>
                <div class="combo">
                    <span style="margin-left:10px;">Movement</span>
                    <div class="inner">
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>
        function sleep (time) {
            return new Promise((resolve) => setTimeout(resolve, time));
        }

        async function begin(n) {
            var images = document.getElementsByClassName("hike");
            for (let i = 0; i < images.length; i++) {
                images[i].style.opacity = 1;
            }
            var top = 1;
            var cur = images.length - 1;

            for (let i = 0; i < 10; i++) {
                document.getElementById("mid").innerHTML = "Day " + (i + 1);
                await sleep(1000);
                changeImg();
            }
            document.getElementById("mid").innerHTML = "Day " + 11;

            async function changeImg() {
                var next = (cur + 1) % images.length;
                images[cur].style.zIndex = top + 1;
                images[next].style.zIndex = top;

                await transition();

                images[cur].style.zIndex = top;
                images[next].style.zIndex = top + 1;
                top++;
                images[cur].style.opacity = 1;
                cur = next;
                if (cur == images.length - 2) {
                    clearInterval(go);
                }
            }

            function transition() {
                return new Promise(function(resolve, reject) {
                    var del = 0.03;
                    var id = setInterval(changeOpacity, 10);
                    function changeOpacity() {
                        images[cur].style.opacity -= del;
                        if (images[cur].style.opacity <= 0) {
                            clearInterval(id);
                            resolve();
                        }
                    }
                });
            }
        }
    </script>
    <script>
        var datesForChecking = []
        const days = ["S", "M", "T", "W", "T", "F", "S"];
        let today = new Date();
        let dates = [];
        let nums = [];
        for (let i = 0; i < 7; i++) {
            datesForChecking.push(fixDate(today))
            dates.push(days[today.getDay()]);
            nums.push(today.getDate());
            today.setDate(today.getDate() - 1);
        }
        dates.reverse();
        nums.reverse();
        datesForChecking.reverse();

        let inners = document.getElementsByClassName("inner");
        for (let i = 0; i < inners.length; i++) {
            for (let j = 0; j < 7; j++) {
                inners[i].innerHTML += "<div>" + dates[j] + "</div>";
            }
        }
        for (let i = 0; i < inners.length; i++) {
            for (let j = 0; j < 7; j++) {
                inners[i].innerHTML += "<div id='n" + i + "" + j +"'>" + nums[j] + "</div>";
            }
        }

        function setIcon(swap){
            $.ajax({
                type: "POST",
                url: "/getMuteStatus",
                dataType: "text",
                success: function(result){
                    let image = document.getElementById("mute__toggle");
                    let muted;
                    if (result == "true") {
                        muted = true;
                    } else {
                        muted = false;
                    }
                    if (swap) {
                        muted = !muted;
                    }
                    if (muted){
                        image.src = "/images/mute.png";
                    } else {
                        image.src = "/images/speaker.png";
                    }
                }
            });
        }

        function changeIcon(){
            document.getElementById("icon").submit();
            setIcon(false);
        }

        function fixDate(date) {
            let year = date.getFullYear().toString();
            let month = (date.getMonth() + 1).toString();
            let day = date.getDate().toString()

            if (month.length == 1) {
                month = "0" + month;
            }
            if (day.length == 1) {
                day = "0" + day;
            }
            return year + "-" + month + "-"+ day;
        }  
    </script>
    <script type="text/javascript">
        const CSVToArray = (data) =>
              data
                .slice(data.indexOf("\n") + 1)
                .split("\n")
                .map((v) => v.split(","));
        const month = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        var t = new Date();
        document.getElementById("m").innerHTML = month[t.getMonth()];
        var max = "";
        var cur = "";
        var name;
        function run() {
            setIcon(true);
            $.ajax({
                type: "POST",
                url: "/getName",
                dataType: "text",
                success: function (content) {
                    name = content;
                }
            });
            $.ajax({
                type: "POST",
                url: "/getMaxAndMin",
                dataType: "text",
                success: function (content) {
                    let gap = content.indexOf(" ");
                    cur = content.slice(0, gap);
                    max = content.slice(gap + 1);
                    document.getElementById("lcur").innerHTML = cur + " days";
                    document.getElementById("lmax").innerHTML = max + " days";
                    let numDays = parseInt(cur);
                    begin(numDays);
                }
            });
            $.ajax({
                type: "POST",
                url: "/getdata",
                dataType: "text",
                success: function (content) {
                    var allData = content.split("\n");
                    var fillWater = [false, false, false, false, false, false, false];
                    var fillFrog = [false, false, false, false, false, false, false];
                    var fillSleep = [false, false, false, false, false, false, false];
                    var fillWorry = [false, false, false, false, false, false, false];
                    var fillNutrition = [false, false, false, false, false, false, false];
                    var fillMovement = [false, false, false, false, false, false, false];
                    for (let i = 0; i < datesForChecking.length; i++) {
                        var recentName = "";
                        for (let j = 0; j < allData.length; j++) {
                            if (allData[j][0] && allData[j][0] == "*") {
                                recentName = allData[j].slice(1, name.length + 1);
                            }
                            if (allData[j][0] && allData[j][0] != "*" && name == recentName) {
                                let currRow = CSVToArray(allData[j])[0];
                                if (datesForChecking[i] == currRow[0]) {
                                    if (currRow[1] != " ") {
                                        fillWater[i] = true;
                                    }
                                    if (currRow[2] != " ") {
                                        fillFrog[i] = true;
                                    }
                                    if (currRow[3] != " ") {
                                        fillSleep[i] = true;
                                    }
                                    if (currRow[4] != " ") {
                                        fillWorry[i] = true;
                                    }
                                    if (currRow[5] != " ") {
                                        fillNutrition[i] = true;
                                    }
                                    if (currRow[6] != " ") {
                                        fillMovement[i] = true;
                                    }
                                }
                            }
                        }
                    }

                    for (let i = 0; i < fillWater.length; i++) {
                        if (fillWater[i]) {
                            document.getElementById("n0" + i).style.background = "#6fd9ff";
                        }
                    }
                    for (let i = 0; i < fillFrog.length; i++) {
                        if (fillFrog[i]) {
                            document.getElementById("n1" + i).style.background = "rgb(130, 255, 130)";
                        }
                    }
                    for (let i = 0; i < fillSleep.length; i++) {
                        if (fillSleep[i]) {
                            document.getElementById("n2" + i).style.background = "rgb(117, 18, 255)";
                        }
                    }
                    for (let i = 0; i < fillWorry.length; i++) {
                        if (fillWorry[i]) {
                            document.getElementById("n3" + i).style.background = "rgb(255, 130, 130)";
                        }
                    }
                    for (let i = 0; i < fillNutrition.length; i++) {
                        if (fillNutrition[i]) {
                            document.getElementById("n4" + i).style.background = "rgb(105, 68, 23)";
                        }
                    }
                    for (let i = 0; i < fillMovement.length; i++) {
                        if (fillMovement[i]) {
                            document.getElementById("n5" + i).style.background = "rgb(255, 190, 85)";
                        }
                    }
                }
                });
            }
        run();
    </script>
    <script type="text/javascript">
        function exit() {
            document.getElementById("form").submit();
        }
        function exit2() {
            document.getElementById("form2").submit();
        }
        function exit3() {
            document.getElementById("results").submit();
        }
        function exit4() {
            document.getElementById("form3").submit();
        }
        function exit5() {
            document.getElementById("form4").submit();
        }
        function exit6() {
            document.getElementById("form5").submit();
        }
        function exit7() {
            document.getElementById("form6").submit();
        }
    </script>
</html>